(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{549:function(t,a){t.exports="data:image/png;base64,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"},670:function(t,a,s){"use strict";s.r(a);var n=s(4),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),n("p",[t._v("AbstractQueuedSynchronizer是Java并发包java.util.concurrent的核心基础组件，是实现Lock的基础。\nAQS实现了对同步状态的管理，以及对阻塞线程进行排队、等待通知等")]),t._v(" "),n("h2",{attrs:{id:"节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#节点"}},[t._v("#")]),t._v(" 节点")]),t._v(" "),n("p",[t._v("AQS通过内置的FIFO同步队列来完成资源获取线程的排队工作。\n如果当前线程获取锁失败时，AQS会将当前线程以及等待状态等信息构造成一个节点（Node）并将其加入同步队列，同时会park当前线程；当同步状态释放时，则会把节点中的线程唤醒，使其再次尝试获取同步状态。")]),t._v(" "),n("center",[n("p",[n("img",{attrs:{src:s(549),alt:"queue"}})])]),t._v(" "),n("p",[t._v("其节点如下：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" prev"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当前节点/线程的前驱节点")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当前节点/线程的后继节点")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),t._v(" thread"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 每一个节点对应一个线程")]),t._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" waitStatus"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 节点状态")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" CANCELLED "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 节点状态：此线程取消了争抢这个锁")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" SIGNAL "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 节点状态：当前node的后继节点对应的线程需要被唤醒(表示后继节点的状态)")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" CONDITION "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 节点状态：当前节点进入等待队列中")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" PROPAGATE "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 节点状态：表示下一次共享式同步状态获取将会无条件传播下去")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" nextWaiter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 共享模式/独占模式")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" SHARED "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 共享模式")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" EXCLUSIVE "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 独占模式")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"主要方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主要方法"}},[t._v("#")]),t._v(" 主要方法")]),t._v(" "),n("h3",{attrs:{id:"入队"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#入队"}},[t._v("#")]),t._v(" 入队")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 1.线程抢锁失败后，封装成node加入队列\n * 2.队列有tail，可直接入队。\n *   2.1入队时CAS操作，通过CAS自旋将node置为tail。\n * 3.队列没有tail，说明队列是空的，node通过enq()方法入队，enq()会初始化head和tail。\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addWaiter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" mode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" node "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 自旋：循环入列，直到成功")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" oldTail "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tail"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldTail "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setPrevRelaxed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldTail"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置前节点为尾节点")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("compareAndSetTail")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldTail"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                oldTail"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("next "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("initializeSyncQueue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"获取锁"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#获取锁"}},[t._v("#")]),t._v(" 获取锁")]),t._v(" "),n("p",[n("strong",[t._v("独占锁概念")]),t._v("\n独占锁也叫排他锁，是指该锁一次只能被一个线程所持有。如果线程T对数据A加上排他锁后，则其他线程不能再对A加任何类型的锁。获得排它锁的线程即能读数据又能修改数据。JDK中的synchronized和 JUC中Lock的实现类就是互斥锁。")]),t._v(" "),n("p",[n("strong",[t._v("共享锁概念")]),t._v("\n共享锁是指该锁可被多个线程所持有。如果线程T对数据A加上共享锁后，则其他线程只能对A再加共享锁，不能加排它锁。获得共享锁的线程只能读数据，不能修改数据。")]),t._v(" "),n("p",[t._v("独占锁获取")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 1.当前线程通过tryAcquire()方法抢锁。\n * 2.线程抢到锁，tryAcquire()返回true，结束。\n * 3.线程没有抢到锁，addWaiter()方法将当前线程封装成node加入同步队列，并将node交由acquireQueued()处理。\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquire")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryAcquire")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 子类的抢锁操作，下文有解释")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquireQueued")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addWaiter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EXCLUSIVE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 子类抢锁失败进入队列中，重点方法，下文详细讲解")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("selfInterrupt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 需要子类实现的抢锁的方法\n * 目前可以理解为通过CAS修改state的值，成功即为抢到锁，返回true；否则返回false。\n * 之后重入锁ReentrantLock、读写锁ReentrantReadWriteLock中会详细讲解。\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryAcquire")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    thrownew "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UnsupportedOperationException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 上文介绍过的入队操作，线程抢锁失败，将当前线程封装成node加入同步队列，并返回node\n * Node.EXCLUSIVE-表示独占锁，先不用关注\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addWaiter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EXCLUSIVE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 重点方法！！\n * 1.只有head的后继节点能去抢锁，一旦抢到锁旧head节点从队列中删除，next被置为新head节点。\n * 2.如果node线程没有获取到锁，将node线程挂起。\n * 3.锁释放时head节点的后继节点唤醒，唤醒之后继续for循环抢锁。\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquireQueued")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" failed "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" interrupted "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注意这里是循环")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n             * 1.node的前置节点是head时，可以调用tryAcquire()尝试去获取锁，获取锁成功则将node置为head\n             * 注意：只有head的后继节点能去抢锁，一旦抢到锁旧head节点从队列中删除，next被置为新head节点\n             * 2.node线程没有获取到锁，继续执行下面另一个if的代码\n             *  此时有两种情况：1)node不是head的后继节点，没有资格抢锁；2)node是head的后继节点但抢锁没成功\n             */")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" p "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("predecessor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" head "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryAcquire")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHead")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("next "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// help GC")]),t._v("\n                failed "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" interrupted"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            \n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n             * shouldParkAfterFailedAcquire(p, node)：通过前置节点pred的状态waitStatus 来判断是否可以将node节点线程挂起\n             * parkAndCheckInterrupt()：将当前线程挂起\n             * 1.如果node前置节点p.waitStatus==Node.SIGNAL(-1)，直接将当前线程挂起，等待唤醒。\n             *      锁释放时会将head节点的后继节点唤醒，唤醒之后继续for循环抢锁。\n             * 2.如果node前置节点p.waitStatus<=0但是不等于-1，\n             *      1)shouldParkAfterFailedAcquire(p, node)会将p.waitStatus置为-1，并返回false；\n             *      2)进入一下次for循环，先尝试抢锁，没获取到锁则又到这里，此时p.waitStatus==-1，就会挂起当前线程。\n             *  3.如果node前置节点p.waitStatus>0，\n             *      1)shouldParkAfterFailedAcquire(p, node)为node找一个waitStatus<=0的前置节点，并返回false；\n             *      2)继续for循环\n             */")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("shouldParkAfterFailedAcquire")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parkAndCheckInterrupt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                interrupted "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("failed"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cancelAcquire")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 通过前置节点pred的状态waitStatus 来判断是否可以将node节点线程挂起\n * pred.waitStatus==Node.SIGNAL(-1)时，返回true表示可以挂起node线程，否则返回false\n * @param pred node的前置节点\n * @param node 当前线程节点\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("shouldParkAfterFailedAcquire")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" pred"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" ws "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pred"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("waitStatus"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ws "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SIGNAL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        returntrue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ws "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n         * waitStatus>0 ，表示节点取消了排队\n         * 这里检测一下，将不需要排队的线程从队列中删除（因为同步队列中保存的是等锁的线程）\n         * 为node找一个waitStatus<=0的前置节点pred\n         */")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prev "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pred "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pred"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prev"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pred"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("waitStatus "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        pred"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("next "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 此时pred.waitStatus<=0但是不等于-1，那么将pred.waitStatus置为Node.SIGNAL(-1)")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("compareAndSetWaitStatus")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pred"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SIGNAL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    returnfalse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 将当前线程挂起\n * LockSupport.park()挂起当前线程；LockSupport.unpark(thread)唤醒线程thread\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parkAndCheckInterrupt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockSupport")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("park")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将当前线程挂起")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("interrupted")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"释放锁"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#释放锁"}},[t._v("#")]),t._v(" 释放锁")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 释放锁之后，唤醒head的后继节点next。\n * 回顾上文讲的acquireQueued()方法，next节点会进入for循环的下一次循环去抢锁\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("release")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryRelease")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 子类实现的释放锁的方法，下文有讲解")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" h "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" head"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" h"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("waitStatus "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("unparkSuccessor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 唤醒node节点（也就是head）的后继节点，下文有讲解")]),t._v("\n        returntrue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    returnfalse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 需要子类实现的释放锁的方法，对应于tryAcquire()\n * 目前可以理解为将state的值置为0。\n * 之后重入锁ReentrantLock、读写锁ReentrantReadWriteLock中会详细讲解。\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryRelease")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    thrownew "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UnsupportedOperationException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 唤醒node节点（也就是head）的后继节点\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("unparkSuccessor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" ws "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("waitStatus"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ws "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("compareAndSetWaitStatus")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" s "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 正常情况，s就是head.next节点")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n     * 有可能head.next取消了等待（waitStatus==1）\n     * 那么就从队尾往前找，找到waitStatus<=0的所有节点中排在最前面的去唤醒\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("waitStatus "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        s "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tail"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prev"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("waitStatus "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                s "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockSupport")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("unpark")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("thread"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 唤醒s节点的线程去抢锁")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"整个过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#整个过程"}},[t._v("#")]),t._v(" 整个过程")]),t._v(" "),n("p",[t._v("线程1来获取锁，此时没有竞争，直接获取到锁。AQS队列为空。")]),t._v(" "),n("p",[t._v("线程2来获取锁，因为线程1占用锁，线程2需要做两件事：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("1）线程2构造成Node到AQS的同步队列中排队。此时初始化同步队列。\n\n2）线程2阻塞，等待被唤醒之后再去抢锁。\n")])])]),n("p",[t._v("线程3来获取锁，锁被占用，同样做两件事：排队并阻塞。")]),t._v(" "),n("p",[t._v("线程1执行完同步代码之后释放锁，唤醒head的后继节点（线程2），线程2获取锁，并把线程2对应的Node置为head。")]),t._v(" "),n("p",[t._v("线程2执行完同步代码之后释放锁，唤醒head的后继节点（线程3），线程3获取锁，并把线程3对应的Node置为head。")]),t._v(" "),n("p",[t._v("线程3执行完同步代码之后释放锁，同步队列中head之后没有节点了，将head置为null即可。")])],1)}),[],!1,null,null,null);a.default=e.exports}}]);